<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Grist Statistics Widget</title>
    <!-- Grist Plugin API -->
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="theme.css">
</head>

<body data-theme="light">
    <div class="container">
        <!-- New Main Header -->
        <div class="main-header">
            <div class="header-filters">
                <div id="mainSelectors" style="display: flex; align-items: center; gap: 16px;">
                    <div class="filter-group">
                        <label><span class="icon icon-calendar" style="width:20px;height:20px;margin-right:4px;"></span>
                            –ì–æ–¥:</label>
                        <select id="yearSelect" onchange="window.logic.applyCustomPeriod()">
                            <option value="all">–í–µ—Å—å –ø–µ—Ä–∏–æ–¥</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><span class="icon icon-calendar" style="width:20px;height:20px;margin-right:4px;"></span>
                            –ú–µ—Å—è—Ü:</label>
                        <select id="monthSelect" onchange="window.logic.applyCustomPeriod()">
                            <option value="all">–í—Å–µ –º–µ—Å—è—Ü—ã</option>
                            <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                            <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                            <option value="3">–ú–∞—Ä—Ç</option>
                            <option value="4">–ê–ø—Ä–µ–ª—å</option>
                            <option value="5">–ú–∞–π</option>
                            <option value="6">–ò—é–Ω—å</option>
                            <option value="7">–ò—é–ª—å</option>
                            <option value="8">–ê–≤–≥—É—Å—Ç</option>
                            <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                            <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                            <option value="11">–ù–æ—è–±—Ä—å</option>
                            <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                        </select>
                    </div>
                    <div class="period-selector" style="margin-top: 0; padding-top: 0; border-top: none;">
                        <label><span class="icon icon-calendar" style="width:20px;height:20px;margin-right:4px;"></span>
                            –î–∏–∞–ø–∞–∑–æ–Ω:</label>
                        <span id="dateRange"
                            style="font-size: 11px; color: var(--text-secondary); margin-left: 4px;">-</span>
                    </div>
                </div>

                <!-- KPI Selectors (Hidden by default) -->
                <div id="kpiSelectors" style="display: none; align-items: center; gap: 16px;">
                    <div class="filter-group">
                        <label><span class="icon icon-calendar" style="width:20px;height:20px;margin-right:4px;"></span>
                            KPI –ì–æ–¥:</label>
                        <select id="kpiYearSelect" onchange="kpiYearChanged()">
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><span class="icon icon-calendar" style="width:20px;height:20px;margin-right:4px;"></span>
                            –ö–≤–∞—Ä—Ç–∞–ª:</label>
                        <select id="kpiQuarterSelect" onchange="kpiQuarterChanged()">
                            <option value="1">1 –ö–≤–∞—Ä—Ç–∞–ª</option>
                            <option value="2">2 –ö–≤–∞—Ä—Ç–∞–ª</option>
                            <option value="3">3 –ö–≤–∞—Ä—Ç–∞–ª</option>
                            <option value="4">4 –ö–≤–∞—Ä—Ç–∞–ª</option>
                        </select>
                    </div>
                </div>
                <!-- Contributions Controls (Hidden by default) -->
                <div id="contributionsControls" style="display: none; align-items: center; gap: 16px; flex: 1;">
                    <button class="nav-btn-back-header" onclick="window.logic.showKpi()">–ù–ê–ó–ê–î</button>

                    <div class="header-stats-bar">
                        <span class="header-stats-label">–°–¢–ê–¢–ò–°–¢–ò–ö–ê –í–ö–õ–ê–î–û–í :</span>
                        <span class="header-stats-item">–í–°–ï–ì–û <strong id="contribTotalHeader">0</strong></span>
                        <span class="header-stats-item">–û–î–û–ë–†–ï–ù–´–• <strong id="contribApprovedHeader">0</strong></span>
                        <span class="header-stats-item">–ù–ï –û–î–û–ë–†–ï–ù–´–• <strong
                                id="contribRejectedHeader">0</strong></span>
                    </div>

                    <div style="flex:1"></div>
                    <button class="btn-add-contribution-header"
                        onclick="window.logic.openContributionCreateModal()">–î–û–ë–ê–í–ò–¢–¨ –í–ö–õ–ê–î</button>
                </div>
            </div>
            <div class="header-right">
                <span class="sheet-name" id="sheetName">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                <span class="greeting-text" id="greetingText"></span>
                <button class="nav-btn icon icon-home" id="homeBtn" onclick="window.logic.showHome()"
                    title="–ì–ª–∞–≤–Ω–∞—è"></button>
                <button class="nav-btn icon icon-calendar" id="calendarBtn" onclick="window.logic.showCalendar()"
                    title="–ö–∞–ª–µ–Ω–¥–∞—Ä—å"></button>
                <button class="nav-btn icon icon-kpi" id="kpiBtn" onclick="window.logic.showKpi()" title="KPI"></button>
                <button class="settings-btn icon icon-settings" onclick="window.logic.openSettings()"
                    title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"></button>
            </div>
        </div>

        <!-- Hidden info for compatibility -->
        <div style="display:none;">
            <span id="totalRows">-</span>
            <span id="filteredRows">-</span>
            <span id="totalColumns">-</span>
            <span id="periodLabel">–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è</span>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
        </div>

        <div id="content" style="display: none;">
            <!-- Two Column Layout -->
            <div class="main-content">
                <!-- Left Column - Tables -->
                <div class="left-column">
                    <!-- Weekly Statistics -->
                    <div id="weeklyStatsSection" class="data-block" style="display: none;">
                        <h3><span class="icon icon-calendar"></span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º</h3>
                        <table class="weekly-table">
                            <thead>
                                <tr>
                                    <th>–ù–µ–¥–µ–ª—è</th>
                                    <th>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã</th>
                                    <th>–ù–æ—Ä–º–∞</th>
                                    <th>–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</th>
                                    <th>–ü—Ä–æ—Å—Ç–æ–π</th>
                                    <th>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</th>
                                    <th>–†–∞–∑–º–µ—á–µ–Ω–æ</th>
                                    <th>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody id="weeklyTableBody"></tbody>
                        </table>
                    </div>

                    <!-- –ü—Ä–æ–µ–∫—Ç -->
                    <div id="projectSection" class="projects-section" style="display: none;">
                        <h2>
                            <span class="icon icon-doc"></span>
                            <span>–ü—Ä–æ–µ–∫—Ç</span>
                        </h2>
                        <table class="projects-table">
                            <thead>
                                <tr>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'name')" style="cursor: pointer;">
                                        –ù–∞–∑–≤–∞–Ω–∏–µ <span id="sort-–ü—Ä–æ–µ–∫—Ç-name">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'pureHours')"
                                        style="cursor: pointer;">
                                        –ß–∞—Å—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ <span id="sort-–ü—Ä–æ–µ–∫—Ç-pureHours">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'tasks')" style="cursor: pointer;">
                                        –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ <span id="sort-–ü—Ä–æ–µ–∫—Ç-tasks">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'avgMainTasks')"
                                        style="cursor: pointer;">
                                        –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ <span id="sort-–ü—Ä–æ–µ–∫—Ç-avgMainTasks">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'markupHours')"
                                        style="cursor: pointer;">
                                        –ß–∞—Å—ã —Ä–∞–∑–º–µ—Ç–∫–∏ <span id="sort-–ü—Ä–æ–µ–∫—Ç-markupHours">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'markupTasks')"
                                        style="cursor: pointer;">
                                        –†–∞–∑–º–µ—á–µ–Ω–æ <span id="sort-–ü—Ä–æ–µ–∫—Ç-markupTasks">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'avgMarkupTasks')"
                                        style="cursor: pointer;">
                                        –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–º–µ—Ç–∫–∏ <span id="sort-–ü—Ä–æ–µ–∫—Ç-avgMarkupTasks">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'additionalHours')"
                                        style="cursor: pointer;">
                                        –ò–Ω—ã–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã <span id="sort-–ü—Ä–æ–µ–∫—Ç-additionalHours">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü—Ä–æ–µ–∫—Ç', 'totalHours')"
                                        style="cursor: pointer;">
                                        –í—Å–µ–≥–æ —á–∞—Å–æ–≤ <span id="sort-–ü—Ä–æ–µ–∫—Ç-totalHours">‚ÜïÔ∏è</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="projectTableBody"></tbody>
                        </table>
                    </div>

                    <!-- –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ -->
                    <div id="overtimeSection" class="projects-section" style="display: none;">
                        <h2>
                            <span class="icon icon-fire"></span>
                            <span>–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</span>
                        </h2>
                        <table class="projects-table">
                            <thead>
                                <tr>
                                    <th onclick="window.logic.sortWorkType('–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', 'name')"
                                        style="cursor: pointer;">
                                        –ù–∞–∑–≤–∞–Ω–∏–µ <span id="sort-–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞-name">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', 'tasks')"
                                        style="cursor: pointer;">
                                        –í—Å–µ–≥–æ –∑–∞–¥–∞—á <span id="sort-–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞-tasks">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', 'hours')"
                                        style="cursor: pointer;">
                                        –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã <span id="sort-–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞-hours">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', 'entries')"
                                        style="cursor: pointer;">
                                        –ó–∞–ø–∏—Å–µ–π <span id="sort-–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞-entries">‚ÜïÔ∏è</span>
                                    </th>
                                    <th onclick="window.logic.sortWorkType('–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', 'avgHours')"
                                        style="cursor: pointer;">
                                        –°—Ä. —á–∞—Å–æ–≤/–∑–∞–¥–∞—á–∞ <span id="sort-–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞-avgHours">‚ÜïÔ∏è</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="overtimeTableBody"></tbody>
                        </table>
                    </div>
                </div><!-- End Left Column -->

                <!-- Right Column - Sidebar -->
                <div class="right-column">
                    <!-- Workload Summary -->
                    <div class="workload-sidebar">
                        <h3><span class="icon icon-stats"></span> –ù–∞–≥—Ä—É–∑–∫–∞ –æ–±—â–∞—è</h3>
                        <div class="circular-progress-container">
                            <div class="liquid-circle">
                                <svg class="liquid-svg" viewBox="0 0 200 200">
                                    <defs>
                                        <clipPath id="circleClip">
                                            <circle cx="100" cy="100" r="90" />
                                        </clipPath>
                                        <linearGradient id="liquidGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#E3FB1E" />
                                            <stop offset="100%" style="stop-color:#9ab012" />
                                        </linearGradient>
                                    </defs>
                                    <g clip-path="url(#circleClip)">
                                        <g id="liquidGroup" transform="translate(0,190)">
                                            <!-- –í–æ–ª–Ω–∞ 1 (–æ—Å–Ω–æ–≤–Ω–∞—è) - —É–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∞–º–ø–ª–∏—Ç—É–¥–∞ -->
                                            <path id="wave1" class="wave-path"
                                                d="M-40,15 Q-10,-8 20,15 Q50,38 80,15 Q110,-8 140,15 Q170,38 200,15 Q230,-8 260,15 L260,200 L-40,200 Z" />
                                            <!-- –í–æ–ª–Ω–∞ 2 (—Å–≤–µ—Ç–ª–∞—è —Å–≤–µ—Ä—Ö—É) -->
                                            <path id="wave2" class="wave-path wave-path-2"
                                                d="M-40,10 Q0,-12 40,10 Q80,32 120,10 Q160,-12 200,10 Q240,32 280,10 L280,200 L-40,200 Z" />
                                        </g>
                                        <!-- –ë—Ä—ã–∑–≥–∏ (–æ—Ç–¥–µ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞) -->
                                        <g id="splashGroup">
                                            <circle class="splash splash-1" cx="30" cy="5" r="4" />
                                            <circle class="splash splash-2" cx="90" cy="8" r="3" />
                                            <circle class="splash splash-3" cx="150" cy="3" r="3.5" />
                                            <circle class="splash splash-4" cx="60" cy="6" r="2" />
                                            <circle class="splash splash-5" cx="120" cy="4" r="2.5" />
                                        </g>
                                    </g>
                                </svg>
                                <div class="percentage-overlay">
                                    <span class="big-percentage" id="workloadPercentage">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="hours-text" id="workloadText">0 —á –∏–∑ 0 —á</div>
                    </div>

                    <!-- Today Stats -->
                    <div class="today-sidebar">
                        <div class="today-header">
                            <h3><span class="icon icon-calendar"></span> –°–µ–≥–æ–¥–Ω—è</h3>
                            <button class="return-today-btn" id="returnTodayBtn" onclick="window.logic.returnToToday()"
                                style="display: none;">
                                <span class="icon icon-arrow">‚Üê</span> –í–µ—Ä–Ω—É—Ç—å—Å—è
                            </button>
                        </div>
                        <div class="today-date-picker">
                            <input type="date" id="todayDateFrom" class="date-input"
                                onchange="window.logic.loadTodayRange()">
                            <span class="date-separator">‚Äî</span>
                            <input type="date" id="todayDateTo" class="date-input"
                                onchange="window.logic.loadTodayRange()">
                        </div>
                        <div class="today-grid">
                            <div class="today-tile">
                                <span class="tile-icon icon icon-time"></span>
                                <span class="tile-value" id="todayTotalHours">-</span>
                                <span class="tile-label">–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã</span>
                            </div>
                            <div class="today-tile">
                                <span class="tile-icon icon icon-fire"></span>
                                <span class="tile-value" id="todayOvertimeHours">-</span>
                                <span class="tile-label">–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</span>
                            </div>
                            <div class="today-tile">
                                <span class="tile-icon icon icon-pause"></span>
                                <span class="tile-value" id="todayIdleHours">-</span>
                                <span class="tile-label">–ü—Ä–æ—Å—Ç–æ–π</span>
                            </div>
                            <div class="today-tile">
                                <span class="tile-icon icon icon-check"></span>
                                <span class="tile-value" id="todayCheckHours">-</span>
                                <span class="tile-label">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>
                            </div>
                            <div class="today-tile">
                                <span class="tile-icon icon icon-tag"></span>
                                <span class="tile-value" id="todayMarkupHours">-</span>
                                <span class="tile-label">–†–∞–∑–º–µ—á–µ–Ω–æ</span>
                            </div>
                            <div class="today-tile">
                                <span class="tile-icon icon icon-doc"></span>
                                <span class="tile-value" id="todayOtherHours">-</span>
                                <span class="tile-label">–ò–Ω—ã–µ –∑–∞–¥–∞—á–∏</span>
                            </div>
                            <div class="today-tile">
                                <span class="tile-icon icon icon-list"></span>
                                <span class="tile-value" id="todayCheckedTasksCount">-</span>
                                <span class="tile-label">–ó–∞–¥–∞—á –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>
                            </div>
                            <div class="today-tile">
                                <span class="tile-icon icon icon-bookmark"></span>
                                <span class="tile-value" id="todayMarkedTasksCount">-</span>
                                <span class="tile-label">–ó–∞–¥–∞—á —Ä–∞–∑–º–µ—á–µ–Ω–æ</span>
                            </div>
                        </div>
                    </div>
                </div><!-- End Right Column -->
            </div><!-- End main-content -->
        </div><!-- End content -->

        <!-- Calendar View -->
        <div id="calendarView" class="calendar-view" style="display: none;">
            <div class="calendar-controls">
                <button class="calendar-nav-btn" onclick="window.logic.prevMonth()">‚óÄ</button>
                <div class="calendar-title-selects">
                    <select id="calendarMonthSelect" class="calendar-select"
                        onchange="window.logic.updateCalendarView()">
                        <option value="0">–Ø–Ω–≤–∞—Ä—å</option>
                        <option value="1">–§–µ–≤—Ä–∞–ª—å</option>
                        <option value="2">–ú–∞—Ä—Ç</option>
                        <option value="3">–ê–ø—Ä–µ–ª—å</option>
                        <option value="4">–ú–∞–π</option>
                        <option value="5">–ò—é–Ω—å</option>
                        <option value="6">–ò—é–ª—å</option>
                        <option value="7">–ê–≤–≥—É—Å—Ç</option>
                        <option value="8">–°–µ–Ω—Ç—è–±—Ä—å</option>
                        <option value="9">–û–∫—Ç—è–±—Ä—å</option>
                        <option value="10">–ù–æ—è–±—Ä—å</option>
                        <option value="11">–î–µ–∫–∞–±—Ä—å</option>
                    </select>
                    <select id="calendarYearSelect" class="calendar-select"
                        onchange="window.logic.updateCalendarView()">
                        <!-- Years will be populated dynamically -->
                    </select>
                </div>
                <button class="calendar-nav-btn" onclick="window.logic.nextMonth()">‚ñ∂</button>
            </div>

            <div class="calendar-grid" id="calendarGrid">
                <!-- Headers -->
                <div class="calendar-header-cell week-number-header">–ù–µ–¥</div>
                <div class="calendar-header-cell">–ü–Ω</div>
                <div class="calendar-header-cell">–í—Ç</div>
                <div class="calendar-header-cell">–°—Ä</div>
                <div class="calendar-header-cell">–ß—Ç</div>
                <div class="calendar-header-cell">–ü—Ç</div>
                <div class="calendar-header-cell" style="color: #e57373;">–°–±</div>
                <div class="calendar-header-cell" style="color: #e57373;">–í—Å</div>
                <!-- Days will be populated via JS -->
            </div>

            <div class="calendar-legend">
                <div class="legend-item">
                    <div class="legend-dot today"></div>
                    <span>–°–µ–≥–æ–¥–Ω—è</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot holiday"></div>
                    <span>–ü—Ä–∞–∑–¥–Ω–∏–∫</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot short"></div>
                    <span>–°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π</span>
                </div>
            </div>
        </div>

        <!-- KPI View (loaded dynamically from kpi.html) -->
        <div id="kpiView" style="display: none;"></div>

        <!-- Settings Modal (Restored & Refined) -->
        <div id="settingsModal" class="modal-overlay">
            <div class="modal neu-raised" style="max-width: 600px;">
                <div class="modal-header">
                    <h3>
                        <div class="header-icon-container">
                            <span class="icon icon-settings"></span>
                        </div>
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </h3>
                    <button class="icon-btn close-modal" onclick="window.logic.closeSettings()">‚úï</button>
                </div>

                <div class="modal-body">
                    <!-- Tabs -->
                    <div class="settings-tabs-container">
                        <div class="settings-tabs">
                            <button id="tab-btn-user" class="tab-btn" onclick="window.logic.switchSettingsTab('user')">
                                <span class="icon icon-user"></span> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                            </button>
                            <button id="tab-btn-calendar" class="tab-btn active"
                                onclick="window.logic.switchSettingsTab('calendar')">
                                <span class="icon icon-calendar"></span> –ö–∞–ª–µ–Ω–¥–∞—Ä—å
                            </button>
                            <button id="tab-btn-theme" class="tab-btn"
                                onclick="window.logic.switchSettingsTab('theme')">
                                <span class="icon icon-star"></span> –¢–µ–º–∞
                            </button>
                        </div>
                    </div>

                    <!-- User Tab Content -->
                    <div id="tab-user" class="settings-tab-content">
                        <div class="form-group">
                            <label><span class="icon icon-user"></span> –í–∞—à–µ –ò–º—è</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="firstName" class="form-input" placeholder="–ò–º—è"
                                    onchange="window.logic.saveUserName()">
                                <input type="text" id="lastName" class="form-input" placeholder="–§–∞–º–∏–ª–∏—è"
                                    onchange="window.logic.saveUserName()">
                            </div>
                            <div class="setting-hint"
                                style="font-size: 11px; color: var(--text-secondary); margin-top: 5px;">
                                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ –ø–æ–ª–Ω–æ–º—É –∏–º–µ–Ω–∏
                            </div>
                        </div>
                    </div>

                    <!-- Calendar Tab Content -->
                    <div id="tab-calendar" class="settings-tab-content active">
                        <!-- Year Selector Row -->
                        <div class="form-group">
                            <label><span class="icon icon-calendar"></span> –ì–æ–¥:</label>
                            <div class="year-row">
                                <select id="calendarYear" class="form-input year-select"
                                    onchange="renderSettingsUI()"></select>
                                <button class="btn-white" onclick="window.logic.addYear()">+ –ì–æ–¥</button>
                                <button class="btn-red" onclick="window.logic.removeYear()">- –£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>

                        <!-- Holidays Section -->
                        <div class="section-block">
                            <h4><span class="icon icon-star"></span> –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ (–≤—ã—Ö–æ–¥–Ω—ã–µ):</h4>
                            <div id="holidaysList" class="tags-list"></div>
                            <div class="add-date-row">
                                <input type="text" id="newHolidayInput" class="form-input dark-input"
                                    placeholder="–î–î.–ú–ú">
                                <button class="btn-lime" onclick="window.logic.addHoliday()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                        </div>

                        <!-- Short Days Section -->
                        <div class="section-block">
                            <h4><span class="icon icon-clock"></span> –°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–µ –¥–Ω–∏ (7 —á–∞—Å–æ–≤):</h4>
                            <div id="shortDaysList" class="tags-list"></div>
                            <div class="add-date-row">
                                <input type="text" id="newShortDayInput" class="form-input dark-input"
                                    placeholder="–î–î.–ú–ú">
                                <button class="btn-lime" onclick="window.logic.addShortDay()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                        </div>

                        <!-- Import/Export Section -->
                        <div class="section-block">
                            <h4><span class="icon icon-box"></span> –ò–º–ø–æ—Ä—Ç / –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫:</h4>
                            <div class="action-buttons-row">
                                <button class="btn-lime-block" onclick="window.logic.exportSettings()">‚Üì –≠–∫—Å–ø–æ—Ä—Ç
                                    JSON</button>
                                <button class="btn-lime-block" onclick="window.logic.importSettings()">‚Üë –ò–º–ø–æ—Ä—Ç
                                    JSON</button>
                                <input type="file" id="importFile" style="display:none"
                                    onchange="window.logic.processImport(this)">
                            </div>
                        </div>
                    </div>

                    <!-- Theme Tab Content -->
                    <div id="tab-theme" class="settings-tab-content">
                        <div class="form-group">
                            <label><span class="icon icon-star"></span> –†–µ–∂–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
                            <select id="themeSelect" class="form-input" onchange="window.logic.saveTheme()">
                                <option value="light">–°–≤–µ—Ç–ª–∞—è (Light)</option>
                                <option value="dark">–¢–µ–º–Ω–∞—è (Dark)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><span class="icon icon-star"></span> –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç</label>
                            <div class="accent-selector" style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="accent-btn" onclick="window.logic.saveAccent('lime')"
                                    style="background: #E3FB1E; width: 30px; height: 30px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer;"></button>
                                <button class="accent-btn" onclick="window.logic.saveAccent('blue')"
                                    style="background: #0984e3; width: 30px; height: 30px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer;"></button>
                                <button class="accent-btn" onclick="window.logic.saveAccent('purple')"
                                    style="background: #6c5ce7; width: 30px; height: 30px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer;"></button>
                                <button class="accent-btn" onclick="window.logic.saveAccent('orange')"
                                    style="background: #e17055; width: 30px; height: 30px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer;"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast">
        <span class="icon">üíæ</span>
        <span class="message">–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</span>
    </div>

    <!-- Day Modal -->
    <div id="dayModal" class="modal-overlay">
        <div class="modal neumorphic-modal" style="max-width: 1100px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 id="dayModalTitle">–ó–∞–¥–∞—á–∏ –∑–∞ –¥–∞—Ç—É</h3>
                <button class="icon-btn close-modal"
                    onclick="document.getElementById('dayModal').classList.remove('active')">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Day Summary Cards -->
                <div class="day-stats-row">
                    <div class="stat-card-small">
                        <div class="stat-value" id="dayWorkHours">0</div>
                        <div class="stat-label">–ß–∞—Å—ã</div>
                    </div>
                    <div class="stat-card-small">
                        <div class="stat-value" id="dayProjects">0</div>
                        <div class="stat-label">–ü—Ä–æ–µ–∫—Ç—ã</div>
                    </div>
                    <div class="stat-card-small">
                        <div class="stat-value" id="dayCheckedTasks">0</div>
                        <div class="stat-label">–ó–∞–¥–∞—á–∏</div>
                    </div>
                </div>

                <!-- Projects Table -->
                <div class="table-container">
                    <table class="projects-table">
                        <thead>
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ß–∞—Å—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                                <th>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</th>
                                <th>–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                                <th>–ß–∞—Å—ã —Ä–∞–∑–º–µ—Ç–∫–∏</th>
                                <th>–†–∞–∑–º–µ—á–µ–Ω–æ</th>
                                <th>–ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–º–µ—Ç–∫–∏</th>
                                <th>–ò–Ω—ã–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã</th>
                                <th>–í—Å–µ–≥–æ —á–∞—Å–æ–≤</th>
                            </tr>
                        </thead>
                        <tbody id="dayProjectsBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- Project Modal -->
    <div id="projectModal" class="modal-overlay">
        <div class="modal neumorphic-modal" style="max-width: 1200px; max-height: 85vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 id="projectModalTitle">–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <button class="icon-btn close-modal"
                    onclick="document.getElementById('projectModal').classList.remove('active')">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Filters Row -->
                <div class="modal-filters" style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
                    <div style="flex: 1;">
                        <label
                            style="font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">–ì–æ–¥</label>
                        <select id="projectYearSelect" class="neumorphic-select"
                            onchange="window.logic.refreshProjectModal()"
                            style="width: 100%; padding: 10px; border-radius: 12px; border: none; background: var(--bg-color); box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); font-weight: 600;">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label
                            style="font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">–ú–µ—Å—è—Ü</label>
                        <select id="projectMonthSelect" class="neumorphic-select"
                            onchange="window.logic.refreshProjectModal()"
                            style="width: 100%; padding: 10px; border-radius: 12px; border: none; background: var(--bg-color); box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); font-weight: 600;">
                            <option value="0">–í—Å–µ –º–µ—Å—è—Ü—ã</option>
                            <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                            <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                            <option value="3">–ú–∞—Ä—Ç</option>
                            <option value="4">–ê–ø—Ä–µ–ª—å</option>
                            <option value="5">–ú–∞–π</option>
                            <option value="6">–ò—é–Ω—å</option>
                            <option value="7">–ò—é–ª—å</option>
                            <option value="8">–ê–≤–≥—É—Å—Ç</option>
                            <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                            <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                            <option value="11">–ù–æ—è–±—Ä—å</option>
                            <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                        </select>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="projectLoading" style="display: none; text-align: center; padding: 40px;">
                    <div class="spinner" style="margin: 0 auto;"></div>
                    <p style="margin-top: 15px; color: var(--text-secondary);">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                </div>

                <!-- Content -->
                <div id="projectContent" style="display: block;">
                    <!-- Summary Stats -->
                    <div class="day-stats-row" style="margin-bottom: 25px;">
                        <div class="stat-card-small">
                            <div class="stat-value" id="projectTotalHours">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ —á–∞—Å–æ–≤</div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-value" id="projectTotalTasks">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-value" id="projectAvgHours">0</div>
                            <div class="stat-label">–°—Ä. —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—è</div>
                        </div>
                    </div>

                    <!-- Weekly Breakdown Table -->
                    <div class="table-container">
                        <table class="projects-table">
                            <thead>
                                <tr>
                                    <th>–ù–µ–¥–µ–ª—è</th>
                                    <th>–î–∞—Ç—ã</th>
                                    <th>–ß–∞—Å—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                                    <th>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</th>
                                    <th>–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                                    <th>–ß–∞—Å—ã —Ä–∞–∑–º–µ—Ç–∫–∏</th>
                                    <th>–†–∞–∑–º–µ—á–µ–Ω–æ</th>
                                    <th>–ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–º–µ—Ç–∫–∏</th>
                                    <th>–ò–Ω—ã–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã</th>
                                    <th>–í—Å–µ–≥–æ —á–∞—Å–æ–≤</th>
                                </tr>
                            </thead>
                            <tbody id="projectWeeklyBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contributions View -->
    <div id="contributionsView" style="display: none;">
        <!-- Loaded dynamically from contribution.html -->
    </div>

    <script src="script.js?v=11"></script>
    <script src="kpi.js?v=11"></script>
    <script src="contribution.js?v=11"></script>
</body>

</html>